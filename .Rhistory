geom_bar(stat = "identity", fill = "deepskyblue") +
labs(x = "Draft Class/Position", y = "Total fWAR",
title = "Top 10 Position Classes by Total fWAR") +
theme_minimal() +
theme(plot.title = element_text(hjust = 0.5)) +
geom_text(aes(label = total_fWAR, vjust = -0.5))
pos_class_fwar
round_numbers <-
as.numeric(unique(players$pick_round[which(as.numeric(players$pick_round) %in% c(1:100))])) %>%
sort()
## Split the data into training and testing datasets
data <- players %>%
filter(home_state %in% tolower(state.abb)) %>%
select(-year, -mlb_played_first, -mlb_played_last,
-c(less_five_war:more_than_25), -birth_year) %>%
mutate(birth_state = tolower(person_birth_state_province),
position = person_primary_position_abbreviation,
.keep = "unused") %>%
mutate(fWAR_class = factor(ifelse(fWAR >= 25, "Greater than 25 fWAR",
ifelse(fWAR >= 20 & fWAR < 25, "20-25 fWAR",
ifelse(fWAR >= 15 & fWAR < 20, "15-20 fWAR",
ifelse(fWAR >= 10 & fWAR < 15,
"10-15 fWAR",
ifelse(fWAR >= 5 & fWAR < 10,
"5-10 fWAR",
"Less than 5 fWAR") ) ) ) ),
levels = c("Greater than 25 fWAR", "20-25 fWAR",
"15-20 fWAR", "10-15 fWAR", "5-10 fWAR",
"Less than 5 fWAR")),
pick_round = factor(pick_round, levels = round_numbers),
top_pick = factor(ifelse(pick_number == 1, 1, 0)),
top_10 = factor(ifelse(pick_number <= 10, 1, 0)),
top_25 = factor(ifelse(pick_number <= 25, 1, 0)),
top_50 = factor(ifelse(pick_number <= 50, 1, 0)),
top_100 = factor(ifelse(pick_number <= 100, 1, 0))) %>%
mutate_if(is.character, as.factor) %>%
drop_na()
# ## person_bat_side code tentative (will include anyways)
# ## All other 17 predictors confirmed important
# ## 29.77822 mins
# set.seed(1)
# boruta <-
#   Boruta(fWAR_class ~ pick_round + pick_number + person_height + person_weight +
#            home_state + person_bat_side_code + person_pitch_hand_code +
#            high_school + yrs_before_debut + debut_age + draft_age +
#            birth_state + position + top_pick + top_10 + top_25 + top_50 +
#            top_100,
#          maxRuns = 250,
#          data = data)
#
# # Extract the feature importance attributes
# boruta_feat_imp <- data.frame(attStats(boruta))
# boruta_feat_imp <- boruta_feat_imp %>%
#   arrange(desc(meanImp)) %>%
#   select(-normHits)
# # Select only the confirmed features of the tested variables
# boruta_feat <- getSelectedAttributes(boruta)
# paste0(boruta_feat, collapse = " + ")
set.seed(1)
data_split <- initial_split(data, prop = 0.70,
strata = position)
train <- training(data_split)
test <- testing(data_split)
# Create the fWAR classification Boosted Decision Tree
boost_model <-
boost_tree(mtry = 17,
trees = 98,
min_n = 8,
tree_depth = 9,
learn_rate = .0988522125906778,
loss_reduction = 0.000000733510996319349,
sample_size = c(1),
stop_iter = c(5)) %>%
set_engine("xgboost") %>%
set_mode("classification")
### Used for tuning parameters
# boost_model <-
#   boost_tree(mtry = tune(),
#              trees = tune(),
#              min_n = tune(),
#              tree_depth = tune(),
#              learn_rate = tune(),
#              loss_reduction = tune(),
#              sample_size = c(1),
#              stop_iter = c(5)) %>%
#   set_engine("xgboost") %>%
#   set_mode("classification")
# Create the + Recipe
boost_recipe <-
recipe(fWAR_class ~ pick_round + pick_number + person_height + person_weight +
home_state + person_bat_side_code + person_pitch_hand_code +
high_school + yrs_before_debut + debut_age + draft_age +
birth_state + position + top_pick + top_10 + top_25 + top_50 +
top_100,
data = train) %>%
step_dummy(all_nominal(), -all_outcomes()) %>%
step_zv(all_predictors()) %>%
step_normalize(all_numeric_predictors())
# + Workflow
boost_wf <-
workflow() %>%
add_recipe(boost_recipe) %>%
add_model(boost_model)
set.seed(1)
boost_folds <- vfold_cv(train, v = 10) # Folds for cross-validation
# # Create a random grid of parameters for model tuning
# boost_grid <- grid_latin_hypercube(
#   mtry(range = c(5, 18)),
#   trees(range = c(25, 150)),
#   min_n(range = c(5, 15)),
#   tree_depth(range = c(5, 15)),
#   learn_rate(),
#   loss_reduction(),
#   size = 1500
# )
# Begin Parallel Processing
all_cores <- parallel::detectCores(logical = FALSE)
cl <- makePSOCKcluster(all_cores)
registerDoParallel(cl)
class_metrics <- metric_set(accuracy, roc_auc, f_meas)
# # Perform the tuning process
# boost_tune_res <- tune_grid(
#   boost_wf,
#   resamples = boost_folds,
#   grid = boost_grid,
#   control = control_grid(save_pred = TRUE),
#   metrics = class_metrics
# )
# best_parameters <- select_best(boost_tune_res, "accuracy")[, 1:6]
# # Update the + Model to the parameters with the "best" (lowest) RMSE
# boost_model <-
#   finalize_model(boost_model, parameters = best_parameters)
#
#
# # Update the + Workflow
# boost_wf <-
#   workflow() %>%
#   add_recipe(boost_recipe) %>%
#   add_model(boost_model)
# 10-fold Cross Validation
set.seed(1)
boost_crossval <-
boost_wf %>%
tune::fit_resamples(resamples = boost_folds,
metrics = class_metrics)
# Cross Validation Metrics
boost_metrics <-
boost_crossval %>%
collect_metrics()
# Fit the + Workflow to the Fastball Training Data
set.seed(1)
boost_fit <-
boost_wf %>%
fit(data = train)
# Make Predictions using the fitted + Model on the Testing Data
boost_predictions <-
boost_fit %>%
predict(test) %>%
rename(estimate = .pred_class) %>%
cbind(test$fWAR_class) %>%
rename(truth = `test$fWAR_class`)
conf_mat <-
confusionMatrix(boost_predictions$estimate, boost_predictions$truth)
# Variable Importance Plot
vip_plot <-
boost_fit %>%
extract_fit_parsnip() %>%
vip(geom = "point") +
labs(title = "Variable Importance Plot")
boost_metrics %>%
select(-.config) %>%
rename(metric = .metric,
estimator = .estimator,
folds = n,
standard_error = std_err) %>%
mutate(mean = round(mean, digits = 4),
standard_error = round(standard_error, digits = 4)) %>%
kbl() %>%
kable_paper(full_width = TRUE)
conf_mat$byClass[, -c(3:6, 11)] %>%
round(digits = 3) %>%
kbl() %>%
kable_paper(full_width = TRUE)
conf_mat$table %>%
round(digits = 3) %>%
kbl() %>%
kable_paper(full_width = TRUE)
conf_mat$byClass[, -c(3:6, 11)] %>%
round(digits = 3) %>%
kbl() %>%
kable_paper(full_width = TRUE, latex_options = "striped")
conf_mat$byClass[, -c(3:6, 11)] %>%
round(digits = 3) %>%
kbl() %>%
kable_paper("striped", full_width = TRUE)
conf_mat$byClass[, -c(3:6, 11)] %>%
round(digits = 3) %>%
kbl() %>%
kable_styling(latex_options = "striped")
boost_metrics %>%
select(-.config) %>%
rename(metric = .metric,
estimator = .estimator,
folds = n,
standard_error = std_err) %>%
mutate(mean = round(mean, digits = 4),
standard_error = round(standard_error, digits = 4)) %>%
kbl()
boost_metrics %>%
select(-.config) %>%
rename(metric = .metric,
estimator = .estimator,
folds = n,
standard_error = std_err) %>%
mutate(mean = round(mean, digits = 4),
standard_error = round(standard_error, digits = 4)) %>%
kbl()
conf_mat$byClass[, -c(3:6, 11)] %>%
round(digits = 3) %>%
kbl()
conf_mat$byClass[, -c(3:6, 11)] %>%
round(digits = 3) %>%
kbl() %>%
kable_styling()
conf_mat$byClass[, -c(3:6, 11)] %>%
round(digits = 3) %>%
kbl() %>%
kable_styling() %>%
toLatex()
conf_mat$byClass[, -c(3:6, 11)] %>%
round(digits = 3) %>%
kbl()
conf_mat$byClass[, -c(3:6, 11)] %>%
round(digits = 3) %>%
kable(format = "latex")
conf_mat$byClass[, -c(3:6, 11)] %>%
round(digits = 3) %>%
kable(format = "latex")
mlb_info
draft_info %>%
# mutate to a factor for sorting purposes
mutate(pick_round = as.numeric(draft_info$pick_round))  %>%
filter(pick_round %in% c(1:100)) %>%
group_by(person_id) %>%
dplyr::slice(which.max(year)) %>%
ungroup() %>%
summarise(`Drafted` = n(), # total number of draftees
`Made MLB` = sum(made_mlb), # number of draftees to make MLB
# percent of players to make the MLB
`% Made MLB` = round( (`Made MLB` / `Drafted`) * 100, 2),
# percent of players to NOT make the MLB
`% Missed MLB` = round((100 - `% Made MLB`), 2))
# Full Draft information breakdown by draft year
mlb_info <-
draft_info %>%
# mutate to a factor for sorting purposes
mutate(pick_round = as.numeric(draft_info$pick_round))  %>%
filter(pick_round %in% c(1:100)) %>%
group_by(person_id) %>%
dplyr::slice(which.max(year)) %>%
ungroup() %>%
summarise(`Drafted` = n(), # total number of draftees
`Made MLB` = sum(made_mlb), # number of draftees to make MLB
# percent of players to make the MLB
`% Made MLB` = round( (`Made MLB` / `Drafted`) * 100, 2),
# percent of players to NOT make the MLB
`% Missed MLB` = round((100 - `% Made MLB`), 2))
mlb_info_long <-
mlb_info %>%
pivot_longer(cols = c( `Made MLB`,  `Drafted`), names_to = "Category",
values_to = "Total Players")
mlb_info_long
mlb_info
pie_chart <-
ggplot(data = mlb_info_long, aes(x = "", y = `Total Players`, fill = Category)) +
geom_bar(stat = "identity", width = 1) +
coord_polar("y", start = 0) +
theme_void() +
labs(title = "Pie Chart of MLB Status") +
geom_text(aes(labels = c(mlb_info$`% Made MLB`, mlb_info$`% Missed MLB`)))
pie_chart
pie_chart <-
ggplot(data = mlb_info_long, aes(x = "", y = `Total Players`, fill = Category)) +
geom_bar(stat = "identity", width = 1) +
coord_polar("y", start = 0) +
theme_void() +
labs(title = "Pie Chart of MLB Status") +
geom_text(aes(label = c(mlb_info$`% Made MLB`, mlb_info$`% Missed MLB`)))
pie_chart
pie_chart <-
ggplot(data = mlb_info_long, aes(x = "", y = `Total Players`, fill = Category)) +
geom_bar(stat = "identity", width = 1) +
coord_polar("y", start = 0) +
theme_void() +
labs(title = "Pie Chart of MLB Status") +
geom_text(aes(label = c(mlb_info$`% Missed MLB`)))
pie_chart
info$`% Made MLB`,
pie_chart <-
ggplot(data = mlb_info_long, aes(x = "", y = `Total Players`, fill = Category)) +
geom_bar(stat = "identity", width = 1) +
coord_polar("y", start = 0) +
theme_void() +
labs(title = "Pie Chart of MLB Status") +
geom_text(aes(label = c(mlb_info$`% Made MLB`, mlb_info$`% Missed MLB`)))
pie_chart
pie_chart <-
ggplot(data = mlb_info_long, aes(x = "", y = `Total Players`, fill = Category)) +
geom_bar(stat = "identity", width = 1) +
coord_polar("y", start = 0) +
theme_void() +
labs(title = "Pie Chart of MLB Status") +
geom_text(aes(label = c(mlb_info$`% Made MLB`, mlb_info$`% Missed MLB`),
hjust = -0.5))
pie_chart
pie_chart <-
ggplot(data = mlb_info_long, aes(x = "", y = `Total Players`, fill = Category)) +
geom_bar(stat = "identity", width = 1) +
coord_polar("y", start = 0) +
theme_void() +
labs(title = "Pie Chart of MLB Status") +
geom_text(aes(label = c(mlb_info$`% Made MLB`, mlb_info$`% Missed MLB`),
hjust = 0.5))
pie_chart
pie_chart <-
ggplot(data = mlb_info_long, aes(x = "", y = `Total Players`, fill = Category)) +
geom_bar(stat = "identity", width = 1) +
coord_polar("y", start = 0) +
theme_void() +
labs(title = "Pie Chart of MLB Status") +
geom_text(aes(label = c(mlb_info$`% Made MLB`, mlb_info$`% Missed MLB`),
hjust = 0.75))
pie_chart
paste(mlb_info$`% Made MLB`, "%")
paste(mlb_info$`% Made MLB`, "%", sep = "")
pie_chart <-
ggplot(data = mlb_info_long, aes(x = "", y = `Total Players`, fill = Category)) +
geom_bar(stat = "identity", width = 1) +
coord_polar("y", start = 0) +
theme_void() +
labs(title = "Pie Chart of MLB Status") +
geom_text(aes(label = c(paste(mlb_info$`% Made MLB`, "%", sep = ""), paste(mlb_info$`% Missed MLB`, "%", sep = "")), hjust = 0.75))
pie_chart
pie_chart <-
ggplot(data = mlb_info_long, aes(x = "", y = `Total Players`, fill = Category)) +
geom_bar(stat = "identity", width = 1) +
coord_polar("y", start = 0) +
theme_void() +
labs(title = "Pie Chart of MLB Status") +
geom_text(aes(label = c(paste(mlb_info$`% Made MLB`, "%", sep = ""), paste(mlb_info$`% Missed MLB`, "%", sep = "")), hjust = 0.85))
pie_chart
pie_chart <-
ggplot(data = mlb_info_long, aes(x = "", y = `Total Players`, fill = Category)) +
geom_bar(stat = "identity", width = 1) +
coord_polar("y", start = 0) +
theme_void() +
labs(title = "Pie Chart of MLB Status") +
geom_text(aes(label = c(paste(mlb_info$`% Made MLB`, "%", sep = ""), paste(mlb_info$`% Missed MLB`, "%", sep = "")), hjust = 0.85, vjust = -0.1))
pie_chart
pie_chart <-
ggplot(data = mlb_info_long, aes(x = "", y = `Total Players`, fill = Category)) +
geom_bar(stat = "identity", width = 1) +
coord_polar("y", start = 0) +
theme_void() +
labs(title = "Pie Chart of MLB Status") +
geom_text(aes(label = c(paste(mlb_info$`% Made MLB`, "%", sep = ""), paste(mlb_info$`% Missed MLB`, "%", sep = "")), hjust = 0.85, vjust = -0.15))
pie_chart
pie_chart <-
ggplot(data = mlb_info_long, aes(x = "", y = `Total Players`, fill = Category)) +
geom_bar(stat = "identity", width = 1) +
coord_polar("y", start = 0) +
theme_void() +
labs(title = "Pie Chart of MLB Status") +
geom_text(aes(label = c(paste(mlb_info$`% Made MLB`, "%", sep = ""), paste(mlb_info$`% Missed MLB`, "%", sep = "")), hjust = 0.85, vjust = -0.18))
pie_chart
pie_chart <-
ggplot(data = mlb_info_long, aes(x = "", y = `Total Players`, fill = Category)) +
geom_bar(stat = "identity", width = 1) +
coord_polar("y", start = 0) +
theme_void() +
labs(title = "Pie Chart of MLB Status") +
geom_text(aes(label = c(paste(mlb_info$`% Made MLB`, "%", sep = ""), paste(mlb_info$`% Missed MLB`, "%", sep = "")), hjust = 0.85, vjust = -0.2))
pie_chart
pie_chart <-
ggplot(data = mlb_info_long, aes(x = "", y = `Total Players`, fill = Category)) +
geom_bar(stat = "identity", width = 1) +
coord_polar("y", start = 0) +
theme_void() +
labs(title = "Pie Chart of MLB Status") +
geom_text(aes(label = c(paste(mlb_info$`% Made MLB`, "%", sep = ""), paste(mlb_info$`% Missed MLB`, "%", sep = "")), hjust = 0.85, vjust = -0.23))
pie_chart
pie_chart <-
ggplot(data = mlb_info_long, aes(x = "", y = `Total Players`, fill = Category)) +
geom_bar(stat = "identity", width = 1) +
coord_polar("y", start = 0) +
theme_void() +
labs(title = "Pie Chart of MLB Status") +
geom_text(aes(label = c(paste(mlb_info$`% Made MLB`, "%", sep = ""), paste(mlb_info$`% Missed MLB`, "%", sep = "")), hjust = 0.85, vjust = -0.25))
pie_chart
pie_chart <-
ggplot(data = mlb_info_long, aes(x = "", y = `Total Players`, fill = Category)) +
geom_bar(stat = "identity", width = 1) +
coord_polar("y", start = 0) +
theme_void() +
labs(title = "Pie Chart of MLB Status") +
geom_text(aes(label = c(paste(mlb_info$`% Made MLB`, "%", sep = ""), paste(mlb_info$`% Missed MLB`, "%", sep = "")), hjust = 0.85, vjust = -0.3))
pie_chart
pie_chart <-
ggplot(data = mlb_info_long, aes(x = "", y = `Total Players`, fill = Category)) +
geom_bar(stat = "identity", width = 1) +
coord_polar("y", start = 0) +
theme_void() +
labs(title = "Pie Chart of MLB Status") +
geom_text(aes(label = c(paste(mlb_info$`% Made MLB`, "%", sep = ""), paste(mlb_info$`% Missed MLB`, "%", sep = "")), hjust = 0.85, vjust = -0.4))
pie_chart
pie_chart <-
ggplot(data = mlb_info_long, aes(x = "", y = `Total Players`, fill = Category)) +
geom_bar(stat = "identity", width = 1) +
coord_polar("y", start = 0) +
theme_void() +
labs(title = "Pie Chart of MLB Status") +
geom_text(aes(label = c(paste(mlb_info$`% Made MLB`, "%", sep = ""), paste(mlb_info$`% Missed MLB`, "%", sep = "")), hjust = 0.85, vjust = -0.5))
pie_chart
pie_chart <-
ggplot(data = mlb_info_long, aes(x = "", y = `Total Players`, fill = Category)) +
geom_bar(stat = "identity", width = 1) +
coord_polar("y", start = 0) +
theme_void() +
labs(title = "Pie Chart of MLB Status") +
geom_text(aes(label = c(paste(mlb_info$`% Made MLB`, "%", sep = ""), paste(mlb_info$`% Missed MLB`, "%", sep = "")), hjust = 0.85, vjust = -0.8))
pie_chart
pie_chart <-
ggplot(data = mlb_info_long, aes(x = "", y = `Total Players`, fill = Category)) +
geom_bar(stat = "identity", width = 1) +
coord_polar("y", start = 0) +
theme_void() +
labs(title = "Pie Chart of MLB Status") +
geom_text(aes(label = c(paste(mlb_info$`% Made MLB`, "%", sep = ""), paste(mlb_info$`% Missed MLB`, "%", sep = "")), hjust = 0.85, vjust = -0.8), size = 12)
pie_chart
pie_chart <-
ggplot(data = mlb_info_long, aes(x = "", y = `Total Players`, fill = Category)) +
geom_bar(stat = "identity", width = 1) +
coord_polar("y", start = 0) +
theme_void() +
labs(title = "Pie Chart of MLB Status") +
geom_text(aes(label = c(paste(mlb_info$`% Made MLB`, "%", sep = ""), paste(mlb_info$`% Missed MLB`, "%", sep = "")), hjust = 0.85, vjust = -0.8), size = 8)
pie_chart
pie_chart <-
ggplot(data = mlb_info_long, aes(x = "", y = `Total Players`, fill = Category)) +
geom_bar(stat = "identity", width = 1) +
coord_polar("y", start = 0) +
theme_void() +
labs(title = "Pie Chart of MLB Status") +
geom_text(aes(label = c(paste(mlb_info$`% Made MLB`, "%", sep = ""), paste(mlb_info$`% Missed MLB`, "%", sep = "")), hjust = 0.85, vjust = -0.8), size = 6)
pie_chart
pie_chart <-
ggplot(data = mlb_info_long, aes(x = "", y = `Total Players`, fill = Category)) +
geom_bar(stat = "identity", width = 1) +
coord_polar("y", start = 0) +
theme_void() +
labs(title = "Pie Chart of MLB Status") +
geom_text(aes(label = c(paste(mlb_info$`% Made MLB`, "%", sep = ""), paste(mlb_info$`% Missed MLB`, "%", sep = "")), hjust = 0.85, vjust = -0.8), size = 5)
pie_chart
pie_chart <-
ggplot(data = mlb_info_long, aes(x = "", y = `Total Players`, fill = Category)) +
geom_bar(stat = "identity", width = 1) +
coord_polar("y", start = 0) +
theme_void() +
labs(title = "Pie Chart of MLB Status") +
geom_text(aes(label = c(paste(mlb_info$`% Made MLB`, "%", sep = ""), paste(mlb_info$`% Missed MLB`, "%", sep = "")), hjust = 0.85, vjust = -0.8), size = 6)
pie_chart
pie_chart <-
ggplot(data = mlb_info_long, aes(x = "", y = `Total Players`, fill = Category)) +
geom_bar(stat = "identity", width = 1) +
coord_polar("y", start = 0) +
theme_void() +
labs(title = "Pie Chart of MLB Status") +
geom_text(aes(label = c(paste(mlb_info$`% Made MLB`, "%", sep = ""), paste(mlb_info$`% Missed MLB`, "%", sep = "")), hjust = 0.75, vjust = -0.8), size = 6)
pie_chart
pie_chart <-
ggplot(data = mlb_info_long, aes(x = "", y = `Total Players`, fill = Category)) +
geom_bar(stat = "identity", width = 1) +
coord_polar("y", start = 0) +
theme_void() +
labs(title = "Pie Chart of MLB Status") +
geom_text(aes(label = c(paste(mlb_info$`% Made MLB`, "%", sep = ""), paste(mlb_info$`% Missed MLB`, "%", sep = "")), hjust = 0.75, vjust = -1), size = 6)
pie_chart
pie_chart <-
ggplot(data = mlb_info_long, aes(x = "", y = `Total Players`, fill = Category)) +
geom_bar(stat = "identity", width = 1) +
coord_polar("y", start = 0) +
theme_void() +
labs(title = "Pie Chart of MLB Status") +
geom_text(aes(label = c(paste(mlb_info$`% Made MLB`, "%", sep = ""), paste(mlb_info$`% Missed MLB`, "%", sep = "")), hjust = 0.75, vjust = -1), size = 5.5)
pie_chart
pie_chart <-
ggplot(data = mlb_info_long, aes(x = "", y = `Total Players`, fill = Category)) +
geom_bar(stat = "identity", width = 1) +
coord_polar("y", start = 0) +
theme_void() +
labs(title = "Pie Chart of MLB Status") +
geom_text(aes(label = c(paste(mlb_info$`% Made MLB`, "%", sep = ""), paste(mlb_info$`% Missed MLB`, "%", sep = "")), hjust = 0.75, vjust = -1), size = 5.4)
pie_chart
pie_chart <-
ggplot(data = mlb_info_long, aes(x = "", y = `Total Players`, fill = Category)) +
geom_bar(stat = "identity", width = 1) +
coord_polar("y", start = 0) +
theme_void() +
labs(title = "Pie Chart of MLB Status") +
geom_text(aes(label = c(paste(mlb_info$`% Made MLB`, "%", sep = ""), paste(mlb_info$`% Missed MLB`, "%", sep = "")), hjust = 0.75, vjust = -1), size = 5.3)
pie_chart
mlb_info
